package com.riskit.riskit

import com.intellij.openapi.ui.DialogWrapper
import com.intellij.ui.components.JBScrollPane
import com.intellij.ui.components.JBTextField
import javax.swing.BoxLayout
import javax.swing.JButton
import javax.swing.JComponent
import javax.swing.JLabel
import javax.swing.JPanel
import javax.swing.JTextField

class CustomVulnerabilityDialog : DialogWrapper(true) {

    private val valueFields = mutableListOf<JTextField>()
    private val mainPanel = JPanel().apply {
        layout = BoxLayout(this, BoxLayout.Y_AXIS)
    }
    private val addButton = JButton("+").apply {
        addActionListener {
            addRow()
            mainPanel.revalidate()
            mainPanel.repaint()
        }
    }

    init {
        title = "Custom Vulnerability"
        addRow()
        mainPanel.add(addButton)
        init()
    }

    private fun addRow() {
        val valueField = JBTextField()
        valueFields.add(valueField)

        val rowPanel = JPanel().apply {
            layout = BoxLayout(this, BoxLayout.X_AXIS)
            add(JLabel("Vulnerability Class:"))
            add(valueField)
        }

        mainPanel.add(rowPanel, mainPanel.componentCount - 1) // Add before the addButton
    }

    fun getVulnerabilityClasses(): List<String> {
        return valueFields.map { it.text }
    }

    override fun createCenterPanel(): JComponent {
        return JBScrollPane(mainPanel)
    }
}